<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-spinner/paper-spinner-lite.html">

<link rel="import" href="../kwc-animations/kwc-particle-burst.html">
<link rel="import" href="../kwc-button/kwc-mega-button.html">
<link rel="import" href="../kwc-share-player/kwc-share-player.html">
<link rel="import" href="../kwc-social-comments/kwc-social-comments.html">
<link rel="import" href="../kwc-style/kwc-style.html">
<link rel="import" href="../kwc-icons/kwc-icons.html">
<!-- Import svg definition as data:uri -->
<link rel="import" href="assets.html">

<!--
`kwc-share-detail`
To display details specific to a kano code share.

@demo demo/index.html
-->

<dom-module id="kwc-share-detail">
    <template>
        <style>
            @keyframes fade-in {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }
            :host {
                background-color: white;
                border-radius: 3px;
                display: block;
                overflow: hidden;
                font-family: var(--font-body);
                @apply --kw-share-detail;
            }
            :host * {
                box-sizing: border-box;
            }
            :host *[hidden] {
                display: none !important;
            }
            .share {
                @apply --layout-vertical;
                @apply --layout-center;
                display: flex;
                width: 100%;
            }
            .share-content {
                @apply --layout-flex;
                background: var(--kw-share-detail-share-background, var(--color-chateau));
                width: 100%;
                padding: 0px 16px;
                min-height: var(--kw-share-detail-player-height, 480px);
                height: var(--kw-share-detail-player-height, 480px);
                box-sizing: border-box;
                position: relative;
            }
            .share-content .loading {
                color: white;
                transition: opacity 200ms linear;
            }
            :host(.loaded) .share-content .loading {
                opacity: 0;
            }
            #share-container {
                animation: fade-in 200ms linear;
            }
            #share-container,
            .share-content .loading,
            .share-content .content,
            .share-content .content .featured,
            .share-content .loading .overlay {
                @apply --layout-fit;
            }
            .share-content .loading .overlay {
                @apply --layout-vertical;
                @apply --layout-center;
                @apply --layout-center-justified;
            }
            .share-content .content .featured,
            kwc-share-player {
                background-color: transparent;
                height: 100%;
                margin: 20px auto;
                max-width: 800px;
                width: 100%;
            }
            kwc-share-player{
                --kwc-share-player-height: 480px;
                position: relative;
                top:50px;
            }
            @media all and (max-width: 680px) {
                .share-content .content .featured,
                #share-container>* {
                    max-height: calc(100% - 120px);
                    padding: 0 20px;
                }
            }
            @media all and (min-width: 681px) {
                .share-content .content .featured,
                #share-container>* {
                    max-height: calc(100% - 100px);
                }
            }
            .featured-icon {
                height: 44px;
                margin-top: 7%;
                width: 44px;
            }
            .share-detail {
                @apply --layout-horizontal;
                max-width: var(--content-width);
                width: 100%;
            }
            .main-details {
                @apply --layout-flex-8;
                padding: 32px 40px 32px 8px;
            }
            .header {
                @apply --layout-horizontal;
            }
            .avatar-wrapper {
                flex: none;
                overflow: hidden;
                width: 48px;
                height: 48px;
                border-radius: 50%;
                position: relative;
                margin: 0 20px;
            }
            .avatar {
                border-radius: 50%;
                cursor: pointer;
                height: 48px;
                overflow: hidden;
                width: 48px;
            }
            .title {
                font-size: 24px;
                line-height: 28px;
                margin: 0;
            }
            .title ::slotted(iron-icon) {
                height: 28px;
                margin-top: -10px;
                width: 28px;
            }
            .attribution {
                font-weight: normal;
                margin: 0;
            }
            .author {
                color: var(--color-carnation);
                cursor: pointer;
                font-weight: bold;
            }
            .description {
                color: var(--color-chateau);
                line-height: 20px;
                margin: 0;
            }
            .description:not(:empty) {
                font-size: 16px;
                margin: 8px 0 0 0;
            }
            .social-nav {
                @apply --layout-horizontal;
                border-bottom: 1px solid var(--color-porcelain);
                color: var(--color-grey);
                list-style: none;
                margin: 0;
                padding: 24px 0 24px 88px;
            }
            .social-nav .nav-item {
                cursor: pointer;
                font-weight: bold;
                margin-right: 20px;
                position: relative;
            }
            .social-nav .nav-icon {
                margin-right: 8px;
                width: 16px;
            }
            .nav-item.active {
                color: black;
            }
            .nav-item.active .nav-icon {
                color: var(--color-sky);
            }
            .nav-item.active::after {
                background-color: white;
                border-left: 1px solid var(--color-porcelain);
                border-radius: 3px 0 0 0;
                border-top: 1px solid var(--color-porcelain);
                bottom: -32px;
                content: "";
                height: 16px;
                left: 0;
                margin: auto;
                position: absolute;
                right: 0;
                transform: rotate(45deg);
                width: 16px;
            }
            kw-social-comment {
                width: 100%;
            }
            .supplementary-details {
                @apply --layout-flex-4;
                border-left: 1px solid var(--color-porcelain);
                color: var(--color-grey);
                padding: 32px 8px 32px 40px;
            }
            kwc-particle-burst {
                display: inline;
                z-index: 10;
                position: relative;
                width: 100%;
            }
            kwc-mega-button {
                width: 100%;
            }
            .actions {
                @apply --layout-justified;
                margin-bottom: 36px;
            }
            .action {
                @apply --layout-flex-auto;
                @apply --layout-horizontal;
                @apply --layout-center;
                @apply --layout-center-justified;
                box-sizing: border-box;
                color: var(--color-abbey);
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
                margin-bottom: 16px;
                position: relative;
                text-align: center;
                text-transform: uppercase;
                transition: 0.3s ease;
            }
            .action > iron-icon {
                color: var(--color-grey);
                margin: -5px 8px 0 0;
                transition: 0.3s ease;
            }
            .action.delete:hover,
            .action.delete:hover > iron-icon {
                color: var(--color-carnation);
            }
            .action-button.view-code {
                --kwc-mega-button-color: var(--color-dodger-blue);
            }
            .action-button.like {
                --kwc-mega-button-color: var(--color-carnation);
                position: relative;
            }
            .like.liked {
                --kwc-mega-button-color: rgba(255, 255, 255, 1);
                --kwc-mega-button-bg-color: var(--color-carnation);
            }
            paper-spinner-lite {
                display: block;
                margin: auto;
                color: black;
                bottom: 39px;
            }
            .action-button.feature.default {
                --kwc-mega-button-color: var(--color-kano-orange);
            }
            .action-button.feature.featured {
                --kwc-mega-button-color: white;
                --kwc-mega-button-bg-color: var(--color-kano-orange);
            }
            .meta-actions {
                border-bottom: 1px solid var(--color-stone);
                border-top: 1px solid var(--color-stone);
                margin-bottom: 36px;
                padding-top: 16px;
            }
            .social-actions {
                @apply --layout-horizontal;
                @apply --layout-start-justified;
                list-style: none;
                margin: 0;
                padding: 10px 0 0 0;
            }
            .social-action {
                box-sizing: border-box;
                margin-right: 16px;
            }
            .social-button {
                border: 0;
                border-radius: 3px;
                color: white;
                cursor: pointer;
                padding: 8px;
                text-transform: uppercase;
                transition: 0.3s ease;
            }
            .social-button:focus {
                outline: 0;
            }
            .social-button.facebook {
                background-color: var(--color-facebook);
            }
            .social-button.twitter {
                background-color: var(--color-twitter);
            }
            .social-button.email {
                background-color: var(--color-kano-orange);
            }
            .social-button .action-icon {
                height: 16px;
                width: 16px;
            }
            .social-actions-header {
                font-weight: bold;
                text-transform: uppercase;
            }
            :host([tombstone]) .avatar,
            :host([tombstone]) .avatar-wrapper {
                background: var(--color-grey-lightest);
                color: transparent;
            }
            :host([tombstone]) .title {
                width: 200px;
                height: 22px;
                background: var(--color-grey-lightest);
                color: transparent;
            }
            :host([tombstone]) .attribution {
                position: relative;
                width: 100px;
                height: 16px;
                background: var(--color-grey-lightest);
                color: transparent;
                margin-top: 6px;
            }
            :host([tombstone]) .description {
                width: 100%;
                height: 36px;
                background: var(--color-grey-lightest);
                color: transparent;
                margin-top: 6px;
                margin-bottom: 12px;
            }
            :host([tombstone]) .supplementary-details,
            :host([tombstone]) #share-container,
            :host([tombstone]) .social {
                opacity: 0.3;
            }
        </style>
        <div id="share" class="share">
            <div class="share-content">
                <div class="loading">
                    <div class="overlay">
                        <paper-spinner-lite class="spinner" active></paper-spinner-lite>
                    </div>
                </div>
                <div class="content">
                    <div class="featured" hidden$="[[!featured]]">
                        <iron-image
                            class="featured-icon"
                            src$="[[_featuredIconUrl]]"
                            sizing="contain"
                            preload fade>
                        </iron-image>
                    </div>
                    <div id="share-container">
                        <slot name="player::before"></slot>
                        <kwc-share-player share="[[shareData]]"
                                          display-code="{{displayCode}}">
                        </kwc-share-player>
                        <slot name="player::after"></slot>
                        <slot name="share-hardware"></slot>
                    </div>
                </div>
            </div>
            <div class="share-detail">
                <div class="main-details">
                    <div class="header">
                        <div class="avatar-wrapper">
                            <iron-image class="avatar"
                                         src$="[[_avatarUrl]]"
                                         sizing="cover"
                                         on-tap="_onUserTapped"
                                         preload fade>
                                        </iron-image>
                        </div>
                        <div class="detail">
                            <h3 class="title">
                                <slot name="title-icon"></slot>
                                [[shareData.title]]
                            </h3>
                            <h4 class="attribution">by
                                <a class="author"
                                   on-tap="_onUserTapped">[[shareData.username]]
                                   </a>
                            </h4>
                            <p class="description">[[shareData.description]]</p>
                        </div>
                    </div>
                    <div class="social">
                        <ul class="social-nav">
                            <li class$="[[_computeNavItemClass(_section, 'comments')]]" on-click="_showComments">
                                <iron-icon class="nav-icon" icon="kwc-social-icons:comment"></iron-icon>
                                <span class="nav-label">[[comments.count]] Replies</span>
                            </li>
                            <li class$="[[_computeNavItemClass(_section, 'likes')]]">
                                <iron-icon class="nav-icon" icon="kwc-social-icons:like"></iron-icon>
                                <span class="nav-label">[[likes.length]] Likes</span>
                            </li>
                        </ul>
                        <!-- Set up with support for showing lists of
                                 likes and remixes in future, when the API support
                                 is available -->
                        <iron-pages id="social-sections"
                                    selected="[[_section]]"
                                    attr-for-selected="section-name"
                                    fallback-selection="comments">
                            <div section-name="comments" class="social-section">
                                <kwc-social-comments id="comments"
                                                     comments="[[comments.entries]]"
                                                     default-avatar="[[_defaultCommentAvatarUrl]]"
                                                     next-page="[[comments.page]]"
                                                     item-id="[[shareData.id]]"
                                                     tombstone$="[[!shareData]]"
                                                     user="[[currentUser]]"
                                                     loader-status="[[commentLoaderStatus]]"
                                                     on-delete-comment="_handleDeleteComment"
                                                     on-load-comment="_handleLoadComment"
                                                     on-post-comment="_handlePostComment"
                                                     on-flag-comment="_handleFlagComment"
                                                     on-view-user="_handleViewUser">
                                                     </kwc-social-comments>
                            </div>
                        </iron-pages>
                    </div>
                </div>
                <div class="supplementary-details">
                    <div class="actions">
                        <slot name='actions::before'></slot>
                        <template is="dom-if" if="[[!_sharedByUser]]">
                            <div class="action">
                                <kwc-particle-burst number-particles="40"
                                                    gravity="0.5"
                                                    particle-decay="0.04"
                                                    max-particle-size="13">
                                    <kwc-mega-button icon-id="kwc-social-icons:like"
                                                     class$="[[_computeLikeClass(liked)]]"
                                                     on-tap="_onLikeTapped">
                                        [[_computedLikeButtonText(liked)]]
                                        <paper-spinner-lite active="[[submitingLike]]">
                                        </paper-spinner-lite>
                                    </kwc-mega-button>
                                </kwc-particle-burst>
                            </div>
                        </template>
                        <slot name='actions::one'></slot>
                        <template is="dom-if" if="[[_showRemixButton(shareData, canRemix)]]">
                            <div class="action">
                                <kwc-mega-button icon-id="kwc-social-icons:code"
                                            class="action-button remix"
                                            on-tap="_onRemixTapped">
                                    Remix
                                </kwc-mega-button>
                            </div>
                        </template>
                        <slot name='actions::two'></slot>
                        <template is="dom-if" if="[[_showCodeButton(shareData)]]">
                            <div class="action">
                                <kwc-mega-button icon-id="kwc-social-icons:code"
                                                 class="action-button view-code"
                                                 on-tap="_toggleCodeView">
                                    View Code
                                </kwc-mega-button>
                            </div>
                        </template>
                        <slot name='actions::three'></slot>
                        <template is="dom-if"
                                  if="[[_showFeaturedButton(shareData, currentUser.admin_level)]]">
                            <div class="action">
                                <kwc-mega-button icon-id="kwc-ui-icons:rosette"
                                                 class$="[[_computeFeatureClass(shareData.featured)]]"
                                                 on-tap="_onFeatureTapped">
                                    Staff Pick
                                </kwc-mega-button>
                            <div>
                        </template>
                        <slot name='actions::after'></slot>
                    </div>
                    <template is="dom-if" if="[[_displayMetaActions]]">
                        <div class="meta-actions">
                            <div class="action delete" on-tap="_onDeleteTapped">
                                <iron-icon icon="kwc-ui-icons:rubbish-bin"></iron-icon>
                                <span>Delete Creation</span>
                            </div>
                        </div>
                    </template>
                    <div class="social-actions-header">Share</div>
                    <ul class="social-actions">
                        <li class="social-action">
                            <button class="social-button facebook" on-tap="_onFacebookTapped">
                                <iron-icon class="action-icon" icon="kwc-social-icons:facebook"></iron-icon>
                            </button>
                        </li>
                        <li class="social-action">
                            <button class="social-button twitter" on-tap="_onTwitterTapped">
                                <iron-icon class="action-icon" icon="kwc-social-icons:twitter"></iron-icon>
                            </button>
                        </li>
                        <li class="social-action">
                            <button class="social-button email" on-tap="_onEmailTapped">
                                <iron-icon class="action-icon" icon="kwc-social-icons:share"></iron-icon>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </template>

    <script>
        (function () {
            Polymer({

                is: 'kwc-share-detail',
                properties: {
                    /**
                     * The current share data to display.
                     * @type {Object}
                     */
                    shareData: {
                        type: Object
                    },
                    /**
                     * Flag to indicate whether the code display div should be shown.
                     * @type {Boolean}
                     */
                    displayCode: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     * Flag to indicate whether the code can be remixed.
                     * Used to decide whether to displat the REMIX button
                     * @type {Boolean}
                     */
                    canRemix: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     * Flag to indicate that the current share attachment is loaded.
                     * @type {Boolean}
                     */
                    loaded: {
                        type: Boolean,
                        value: false,
                        notify: true
                    },
                    /**
                     * Computed property that gives a url for the avatar to show for the
                     * share author.
                     * @type {String}
                     */
                    _avatarUrl: {
                        type: String,
                        computed: '_computeAvatarUrl(shareData)'
                    },
                    /**
                     * A comments object. Expects a property called `entries` that is to
                     * be passed to the `kwc-social-comments` component and a count property of the
                     * number of comments ojects in the `entries` array.
                     * ```js
                     * {
                     *     "type": "object",
                     *     "properties": {
                     *         "entries": {
                     *             "type": "object",
                     *             "properties": // See https://components.kano.me/#/elements/kwc-social-comments
                     *         },
                     *         "count": {
                     *             "type": "number"
                     *         },
                     *         "page": {
                     *             "type": "number"
                     *         }
                     *     },
                     *     "required" : ["entries", "count"]
                     * }
                     * ```
                     * @type {Object}
                     */
                    comments: {
                        type: Object,
                        value: () => {
                            return {};
                        }
                    },
                    /**
                     * A computed flag (based on the comments.page property) to indicate
                     * the social comments component whether there are more comments to load.
                     * @type {Boolean}
                     */
                    commentLoaderStatus: {
                        type: String,
                        computed: "_computeLoaderStatus(comments.*)"
                    },
                    /**
                     * A url to use as the default avatar for the comments component to use
                     * when a comment author does not have one set.
                     * @type {String}
                     */
                    _defaultCommentAvatarUrl: {
                        type: String,
                        value: () => {
                            return KwcShareDetail.assets.avatar;
                        }
                    },
                    /**
                     * Convenience flag to indicate whether the controls for the
                     * share – delete button etc – should be displayed
                     * @type {Boolean}
                     */
                    _displayMetaActions: {
                        type: Boolean,
                        computed: '_computeMetaActionDisplay(_sharedByUser, _userIsAdmin)'
                    },
                    /**
                     * Flag whether the share is featured on not.
                     * @type {Boolean}
                     */
                    featured: {
                        type: Boolean,
                        value: false,
                        reflectToAtrribute: true
                    },
                    /**
                     * Allow the icon to display for a featured share to be set from
                     * outside the component
                     * @type {String}
                     */
                    featuredIconUrl: {
                        type: String,
                        value: null
                    },
                    /**
                     * Use the `featuredIconUrl` or a default icon url.
                     * @type {String}
                     */
                    _featuredIconUrl: {
                        type: String,
                        computed: '_computeFeaturedIconUrl(featuredIconUrl)'
                    },
                    /**
                     * Currently authenticated user. An object with the user data
                     * @type {Object}
                     */
                    currentUser: {
                        type: Object,
                        value: () => {
                            return {};
                        }
                    },
                    /**
                     * A selector for the subpage to show in the social nav. Currently only
                     * one option, but set up to accept remix tab when implemented.
                     * @type {String}
                     */
                    _section: {
                        type: String,
                        value: "comments"
                    },
                    /**
                     * A list of like objects used to calculate the number of likes for the share
                     * and whether the current user has liked this particular share.
                     * @type {Array}
                     */
                    likes: {
                        type: Array,
                        value: () => {
                            return [];
                        }
                    },
                    /**
                     * Computed property that watches the liked list and returns true is
                     * it contains a like with the current user id.
                     * @type {Boolean}
                     */
                    liked: {
                        type: Boolean,
                        computed: '_computeLiked(likes.*, currentUser)'
                    },
                    /**
                     * Property to indicate whether we are currently submiting a like request.
                     * @type {Boolean}
                     */
                    submitingLike: {
                        type: Boolean,
                        value: false
                    },
                    /**
                     * Flag to indicate if the current share is authored by the current authenticated
                     * user. This can inform the UI what should be hidden or shown accordingly.
                     * @type {Boolean}
                     */
                    _sharedByUser: {
                        type: Boolean,
                        computed: '_computeSharedByUser(shareData, currentUser)'
                    },
                    /**
                     * Convenience flag to indicate whether the current user
                     * is an admin
                     * @type {Boolean}
                     */
                    _userIsAdmin: {
                        type: Boolean,
                        computed: '_computeUserIsAdmin(currentUser.admin_level)'
                    }
                },
                observers: [
                    '_shareDataChanged(shareData.*)'
                ],
                /** Computed values*/
                _computeAvatarUrl(shareData) {
                    if (shareData) {
                        if (shareData.userAvatar) {
                            return shareData.userAvatar;
                        } else {
                            return KwcShareDetail.assets.avatar;
                        }
                    } else {
                        /** No share provided, don't set the avatar */
                        return ''; //Valid URI
                    }
                },
                _computeLoaderStatus(commentChangeObj){
                    let comments = commentChangeObj.base;
                    if (comments){
                        return comments.page ? "on" : "off";
                    } else {
                        return "off";
                    }
                },
                _computeFeaturedIconUrl() {
                    if (this.featuredIconUrl) {
                        return this.featuredIconUrl;
                    }
                    return (KwcShareDetail && KwcShareDetail.assets)
                        ? KwcShareDetail.assets.featured
                        : ''; //Valid URI
                },
                _computeFeatureClass (featured) {
                    let baseClass = 'action-button feature',
                        activeClass = featured ? 'featured' : 'default';
                    return `${baseClass} ${activeClass}`;
                },
                _computeSharedByUser (shareData, currentUser) {
                    if (!shareData || !currentUser) {
                        return false;
                    }
                    return shareData.userId === currentUser.id;
                },
                _computeLiked (likeChangeObj, currentUser) {
                    let likes = likeChangeObj.base;
                    if (likes && likes.length && currentUser) {
                        let liked = likes.some((like) => {
                            return like.user === currentUser.id;
                        });
                        return liked;
                    } else {
                        return false;
                    }
                },
                _computeLikeClass (liked) {
                    let baseClass = 'action-button like',
                        activeClass = liked ? 'liked' : 'not-liked';
                    return `${baseClass} ${activeClass}`;
                },
                _computedLikeButtonText (liked) {
                    return liked ? "liked" : "like";
                },
                _computeNavItemClass(section, id) {
                    let baseClass = 'nav-item',
                        activeClass = section === id ? 'active' : 'inactive';
                    return `${baseClass} ${activeClass}`;
                },
                /**
                 * Compute whether share controls – delete button etc – should
                 * display
                 * @param {Boolean} sharedByUser
                 * @param {Boolean} userIsAdmin
                 * @returns {Boolean}
                 */
                _computeMetaActionDisplay(sharedByUser, userIsAdmin) {
                    return sharedByUser || userIsAdmin;
                },
                /**
                 * Compute whether the current user is an adminstrator
                 * @param {Number} adminLevel
                 * @returns {Boolean}
                 */
                _computeUserIsAdmin(adminLevel) {
                    return adminLevel && adminLevel > 0;
                },
                _shareDataChanged(shareDataChangeObj) {
                    let shareData = shareDataChangeObj.base;
                    if (shareData && shareData.id){
                        return this.toggleClass('loaded', true);
                    }
                },
                _showComments() {
                    this.set('_section', 'comments');
                },
                _showLikes() {
                    this.set('_section', 'likes');
                },
                _showCodeButton (shareData) {
                    let attachmentExt;
                    if (shareData && shareData.attachment_url) {
                        attachmentExt = shareData.attachment_url.split('.').pop();
                        if (['html', 'draw', 'lightcode'].indexOf(attachmentExt) !== -1) {
                            return true;
                        }
                    }
                    return false;
                },
                /**
                 * Check whether this share can be remixed (or not)
                 * @param {Object} share Current share data
                 * @param {Boolean} canRemix Flag this share can be remixed
                 * @return {Boolean}
                 */
                _showRemixButton (share, canRemix) {
                    if (share && canRemix){
                        return true;
                    } else {
                        return false;
                    }
                },
                /**
                 * Check whether the current user is admin. Used to hide or show the
                 * fetured button.
                 * @param {Object} share Current share data
                 * @param {Boolean} isAdmin Flag this user as admin
                 * @return {Boolean}
                 */
                _showFeaturedButton (share, isAdmin){
                    return share && isAdmin;
                },
                _onDeleteTapped () {
                    this.dispatchEvent(new CustomEvent('action-click', {
                        detail: {
                            action: 'delete',
                            id: this.shareData ? this.shareData.id : null,
                            slug: this.shareData ? this.shareData.slug : null
                        }
                    }));
                },
                /** Event listeners */
                _onFeatureTapped () {
                    this.dispatchEvent(new CustomEvent('action-click', {
                        detail: {
                            action: 'feature',
                            feature: !this.shareData.featured,
                            id: this.shareData.id
                        }
                    }));
                },
                _onLikeTapped () {
                    if (this._sharedByUser || this.submitingLike) {
                        return;
                    }
                    if (!this.liked) {
                        let particleBursts = Polymer.dom(this.root)
                                .querySelectorAll('kwc-particle-burst');
                        particleBursts.forEach((burst) => {
                            burst.triggerParticles();
                            window.setTimeout(() => burst.triggerParticles(), 250);
                        })
                    }
                    this.dispatchEvent(new CustomEvent('action-click', {
                        detail: {
                            action: "like",
                            liked: !this.liked,
                            shareId: this.shareData ? this.shareData.id : null,
                            shareUserId: this.shareData ? this.shareData.userId : null,
                            userId: this.currentUser ? this.currentUser.id : null
                        }
                    }));
                },
                _onRemixTapped () {
                    let item = this.shareData;
                    if (!item){return;}

                    this.dispatchEvent(new CustomEvent('action-click', {
                        detail:{
                            action: "remix",
                            shareId: item.id,
                            shareSlug: item.slug,
                            shareType: item.app
                        }
                    }));
                },
                _toggleCodeView() {
                    let newValue = !this.displayCode;
                    this.set('displayCode', newValue);
                },
                _onUserTapped() {
                    let share = this.shareData;
                    if (!share){return;}
                    this.dispatchEvent(new CustomEvent('view-user', {
                        detail: {
                            id: this.shareData.userId,
                            username: this.shareData.username
                        }
                    }));
                },
                _onEmailTapped() {
                    this.dispatchEvent(new CustomEvent('social-share', {
                        detail: {
                            action: 'email',
                            share: this.shareData
                        }
                    }));
                },
                _onFacebookTapped() {
                    this.dispatchEvent(new CustomEvent('social-share', {
                        detail: {
                            action: 'facebook',
                            share: this.shareData
                        }
                    }));
                },
                _onTwitterTapped() {
                    this.dispatchEvent(new CustomEvent('social-share', {
                        detail: {
                            action: 'twitter',
                            share: this.shareData
                        }
                    }));
                },
                _handleDeleteComment (e) {
                    this.dispatchEvent(new CustomEvent('delete-comment', {
                        detail: e.detail
                    }));
                },
                _handlePostComment (e) {
                    this.dispatchEvent(new CustomEvent('post-comment', {
                        detail: e.detail
                    }));
                },
                _handleLoadComment (e) {
                    this.dispatchEvent(new CustomEvent('load-comment', {
                        detail: e.detail
                    }));
                },
                _handleFlagComment (e) {
                    this.dispatchEvent(new CustomEvent('flag-comment', {
                        detail: e.detail
                    }));
                },
                _handleViewUser (e) {
                    this.dispatchEvent(new CustomEvent('view-user', {
                        detail: e.detail
                    }));
                }

            });
        })();
    </script>
</dom-module>
